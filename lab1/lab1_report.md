University: [ITMO University](https://itmo.ru/ru/)

Faculty: [FICT](https://fict.itmo.ru)

Course: [Network programming](https://github.com/itmo-ict-faculty/network-programming)

Year: 2024

Group: K34202

Author: Islamov Sergey Sergeevich

Lab: Lab1

Date of create: 26.09.2024

Date of finished: 26.09.2024

Тема работы: Установка CHR и Ansible, настройка VPN

Цель работы: развертывание виртуальной машины с установленной системой контроля конфигураций Ansible и установка CHR в VirtualBox

Ход работы:
1. Создаём виртуальную машину в GCP на операционной системе Ubuntu 20.04.

2. Подключаемся к ней по ssh, устанавливаем ansible.

[![image](https://github.com/user-attachments/assets/c6d0d4e7-91bb-488b-a464-f7b93783a3e7)](https://github.com/16Angeles/2024_2025-network_programming-k34202-islamov_s_s/blob/0592d3f3b6a1fe3f71c73a864d57dca8cfdae845/lab1/1.jfif)

4. В VirtualBox устанавливаем MikroTik, это будет важно для дальнейшей работы. Здесь имеет смысл обратить внимание на то, что после загрузки в настройках VirtualBox необходимо отключить загрузочный диск вручную, тогда как на установке более привычных операционных систем это происходит автоматически.

5. После этого устанавливаем Wireguard на удалённую машину, прописываем в нём в файл условий интерфейса. Создаём пару ключей.

6. После этого начинаем работу с MikroTik. С помощью WinBox открываем графический интерфейс WG и делаем конфиг клиента.

8. Заполняем строки: MTU оставляем как указано(при надобности можно поставить выше/ниже, зависимо от размера пакетов), ListenPort узнаём командой вывода файла /etc/wireguard/wg0.conf на сервере, ключи будут сгененрированы автоматически.

9. Переходим во вторую вкладку, там создаём Peer - указываем только что созданный интерфейс, указываем публичный ключ сервера, его публичный IP, указанный ранее порт и сеть адресов, по которым будет идти подключение.

10. В настройке IP - Addresses указываем выбранную сеть и созданный интерфейс.

13. В настройке IP - Firewall создаём NAT Rule masquerade, Masquerade NAT позволяет преобразовывать несколько IP-адресов в другой одиночный IP-адрес. Можно использовать маскарадный NAT, чтобы скрыть один или несколько IP-адресов во внутренней сети за IP-адресом, который нужно сделать общедоступным.

14. Теперь для проверки работоспособности запускаем ping к виртуальной машине по заданному IP адресу. Пинг идёт - следовательно, все настройки выполнены корректно.

15. В результате получаем связь по заданной схеме из лабораторной работы. 

Выводы: При помощи WireGuard возможно настроить VPN туннель между виртуальной машиной с операционной системой RouterOS и удалённой виртуальной машиной, но только если вы отправляете пакеты из РФ в РФ, потому что к сожалению для иностранных ресурсов WG заблокирован. Для работы с RouterOS достаточно удобно использовать графический интерфейс WinBox, так как он значительно уменьшает время выполнения.
